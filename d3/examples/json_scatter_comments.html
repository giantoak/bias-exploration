<!doctype html>
<html>
<head>
<title>Scatterplot of JSON data</title>
    <script type="text/javascript" src="../d3/d3.min.js"></script>

<script type="text/javascript">
function draw(data) {
  "use strict";

  // pre-determined width and heights
  var w=800, h=400;
  var pad = {left: 20, right: 20, top: 20, bottom: 20};
  
  // there were no HTML elements inside body. everything is created on-the-fly
  var svg = d3.select("body")
                .append("svg")
                  .attr("height", h)
                  .attr("width", w);
  
  // this is the gray-ish background area for the scatterplot.
  // we can play with this; also we can maybe put soft grid lines in the back
  // a la ggplot

  svg.append("rect")
       .attr("x", pad.left).attr("y",pad.top)
       .attr("width", w-(pad.left+pad.right))
       .attr("height",h-(pad.top+pad.bottom))
       .attr("stroke", "black")
       .attr("fill", "rgb(230,230,230)");

  // the way these work is d3.min(data, access_func), where acces_func is
  // expected to give back the relevant datapoint from data
  var xMin = d3.min(data, function(d) { return Number(d.x); });
  var xMax = d3.max(data, function(d) { return Number(d.x); });
  var yMin = d3.min(data, function(d) { return Number(d.y); });
  var yMax = d3.max(data, function(d) { return Number(d.y); });

  // creates scale object for changing the given domain to the given range
  // if xMin is 0 and xMax is 1, and pad.left*2 is 0 and w-pad.right*2 is 2,
  // then all the points will be doubled on the x axis to fit the range.
  // in this case, the range goes from inside the padding on one side to the other
  var xScale = d3.scale.linear().domain([xMin, xMax]).range([pad.left*2, w-pad.right*2]);
  var yScale = d3.scale.linear().domain([yMin, yMax]).range([h-pad.bottom*2, pad.top*2]);

  // circles dynamically created
  var circles = svg.selectAll("circle")
                      .data(data)
                      .enter()
                        .append("circle")
                          // the scale function works like this:
                          .attr("cx", function(d) { return xScale(d.x); })
                          .attr("cy", function(d) { return yScale(d.y); })
                          .attr("r", 5)
                          .attr("opacity", 0.8)
                          // fill selects one of 3 colors based off of the z value
                          .attr("fill", function(d) { return ['blue', 'green', 'red'][d.z-1]; })
                          // select can be used on `this` to change attributes
                        .on("mouseover", function() { d3.select(this).attr("r", 10) })
                        .on("mouseout", function() { d3.select(this).attr("r", 5) });
}
</script>
</head>
<body>
<script type="text/javascript">
// json data is read in
// this file looks like this:
/*[
   {
    "x": 0.30148,
    "y": 2.4615,
    "z":      3 
    },
    {
     "x": -0.29836,
     "y": -2.0909,
     "z":      2 
     },
    ...
]
*/
  d3.json("dat.json", draw);
</script>
</body>
</html>
